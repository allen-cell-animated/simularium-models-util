<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>simularium_models_util.microtubules.microtubules_util &mdash; Simularium Models Util 0.0.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Simularium Models Util
          </a>
              <div class="version">
                0.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#stable-release">Stable release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation.html#from-sources">From sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Package modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../simularium_models_util.html">simularium_models_util package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../simularium_models_util.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../simularium_models_util.actin.html">simularium_models_util.actin package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../simularium_models_util.common.html">simularium_models_util.common package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../simularium_models_util.kinesin.html">simularium_models_util.kinesin package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../simularium_models_util.microtubules.html">simularium_models_util.microtubules package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../simularium_models_util.visualization.html">simularium_models_util.visualization package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../simularium_models_util.html#module-simularium_models_util">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#get-started">Get Started!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#deploying">Deploying</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Simularium Models Util</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
          <li><a href="../../simularium_models_util.html">simularium_models_util</a> &raquo;</li>
      <li>simularium_models_util.microtubules.microtubules_util</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for simularium_models_util.microtubules.microtubules_util</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">readdy</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">from</span> <span class="nn">..common</span> <span class="kn">import</span> <span class="n">ReaddyUtil</span>


<span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="set_parameters"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.set_parameters">[docs]</a><span class="k">def</span> <span class="nf">set_parameters</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">parameters</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">p</span></div>


<div class="viewcode-block" id="MicrotubulesUtil"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil">[docs]</a><span class="k">class</span> <span class="nc">MicrotubulesUtil</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Utility functions for ReaDDy microtubules models</span>

<span class="sd">        Parameters need to be accessible in ReaDDy callbacks</span>
<span class="sd">        which can&#39;t be instance methods, so parameters are global</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">set_parameters</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

<div class="viewcode-block" id="MicrotubulesUtil.get_random_tubulin_neighbors"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_random_tubulin_neighbors">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_random_tubulin_neighbors</span><span class="p">(</span>
        <span class="n">topology</span><span class="p">,</span> <span class="n">types_include</span><span class="p">,</span> <span class="n">types_exclude</span><span class="p">,</span> <span class="n">GTP_state</span><span class="p">,</span> <span class="n">polymer_offsets</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get a random pair of neighbor tubulins of the given types,</span>
<span class="sd">        GTP state, and polymer offsets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">topology</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_vertices</span><span class="p">():</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_satisfies_type</span><span class="p">(</span>
                <span class="n">pt</span><span class="p">,</span>
                <span class="n">types_include</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">([</span><span class="s2">&quot;GDP&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">GTP_state</span> <span class="o">==</span> <span class="s2">&quot;GDP&quot;</span> <span class="k">else</span> <span class="p">[]),</span>
                <span class="n">types_exclude</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">):</span>
                <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">GTP_state</span> <span class="o">==</span> <span class="s2">&quot;GDP&quot;</span><span class="p">:</span>
            <span class="n">types_include</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;GDP&quot;</span><span class="p">]</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">polymer_offsets</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">extra_types</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">GTP_state</span> <span class="o">==</span> <span class="s2">&quot;GTP&quot;</span>
                    <span class="ow">and</span> <span class="s2">&quot;GTP&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">extra_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GTP&quot;</span><span class="p">]</span>
                <span class="n">nt</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_satisfies_type</span><span class="p">(</span>
                    <span class="n">nt</span><span class="p">,</span> <span class="n">types_include</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">extra_types</span><span class="p">,</span> <span class="n">types_exclude</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">neighbors</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.get_neighboring_tubulin"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_neighboring_tubulin">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_neighboring_tubulin</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">vertex</span><span class="p">,</span> <span class="n">polymer_offsets</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the next tubulin neighbor in the branch from site named direction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span>
            <span class="n">vertex</span><span class="p">,</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">polymer_indices_to_string</span><span class="p">(</span>
                <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">increment_polymer_indices</span><span class="p">(</span>
                    <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_polymer_indices</span><span class="p">(</span>
                        <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">polymer_offsets</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.tubulin_has_sites"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.tubulin_has_sites">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">tubulin_has_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        does the tubulin have sites attached?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="s2">&quot;site#out&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.get_tubulin_sites"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_tubulin_sites">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the site particles attached to this tubulin vertex</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">tubulin_has_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="s2">&quot;site#out&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="s2">&quot;site#3&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.polymer_indices_to_string"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.polymer_indices_to_string">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">polymer_indices_to_string</span><span class="p">(</span><span class="n">polymer_indices</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the x and y polymer index for a particle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">polymer_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">polymer_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.increment_polymer_indices"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.increment_polymer_indices">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">increment_polymer_indices</span><span class="p">(</span><span class="n">polymer_indices</span><span class="p">,</span> <span class="n">polymer_offsets</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        increment the x and y polymer index for a particle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">polymer_offsets</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">clamp_polymer_offsets_2D</span><span class="p">(</span>
            <span class="n">polymer_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">polymer_offsets</span>
        <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">calculate_polymer_number</span><span class="p">(</span><span class="n">polymer_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">polymer_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">calculate_polymer_number</span><span class="p">(</span><span class="n">polymer_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">polymer_offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.get_polymer_indices"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_polymer_indices">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_polymer_indices</span><span class="p">(</span><span class="n">particle_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the x and y polymer index for a particle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;tubulin&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">particle_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">flag_string</span> <span class="o">=</span> <span class="n">particle_type</span><span class="p">[</span><span class="n">particle_type</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">flag_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">flags</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">flags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.get_polymer_offsets"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_polymer_offsets">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_polymer_offsets</span><span class="p">(</span><span class="n">particle_types</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the offsets between two particle&#39;s polymer indices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">polymer_indices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_polymer_indices</span><span class="p">(</span><span class="n">particle_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_polymer_indices</span><span class="p">(</span><span class="n">particle_types</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">]</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">polymer_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">polymer_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="n">offset</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">offset</span><span class="p">)))</span>
            <span class="n">offsets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">offsets</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.get_filament_lengths"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_filament_lengths">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_filament_lengths</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin_minus</span><span class="p">,</span> <span class="n">tubulin_plus</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the lengths of the filaments, cut off the larger one</span>
<span class="sd">        at one larger than the smaller</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">next_tub_minus</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">tubulin_minus</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">next_tub_plus</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">tubulin_plus</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">next_tub_minus</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">next_tub_plus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">next_tub_minus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">next_tub_plus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_filament_lengths</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">next_tub_minus</span><span class="p">,</span> <span class="n">next_tub_plus</span>
            <span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.filament_is_crosslinked"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.filament_is_crosslinked">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">filament_is_crosslinked</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        does the fragment starting at the given tubulin</span>
<span class="sd">        and going the given direction (-1 or 1) along a filament</span>
<span class="sd">        have any crosslinks to other filaments?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">neighbor_tub</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">neighbor_tub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="n">next_tub</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="p">[</span><span class="n">direction</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">next_tub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">filament_is_crosslinked</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">next_tub</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.remove_bent_filament_site_bonds"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.remove_bent_filament_site_bonds">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_bent_filament_site_bonds</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulin_minus</span><span class="p">,</span> <span class="n">tubulin_plus</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        remove bonds between the sites of tubulin1 and tubulin2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v_sites_minus</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin_minus</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_sites_minus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to find sites on bent tubulin (&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin_minus</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">v_sites_plus</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin_plus</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_sites_plus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to find sites on bent tubulin (&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin_plus</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v_sites_plus</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">v_sites_minus</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">removed</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">try_remove_edge</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">v_sites_plus</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v_sites_minus</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">removed</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">v_sites_plus</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v_sites_minus</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">removed</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">try_remove_edge</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">v_sites_plus</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">v_sites_minus</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">removed</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.remove_tubulin_sites"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.remove_tubulin_sites">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        emit a tubulin&#39;s site particles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v_sites</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_sites</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v_sites</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">recipe</span><span class="o">.</span><span class="n">separate_vertex</span><span class="p">(</span><span class="n">v_sites</span><span class="p">[</span><span class="n">site</span><span class="p">])</span>
                <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span><span class="n">v_sites</span><span class="p">[</span><span class="n">site</span><span class="p">],</span> <span class="s2">&quot;site#remove&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.set_free"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.set_free">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">set_free</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        emit each tubulin&#39;s site particles and change its type to tubulin#free</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">tubulin</span> <span class="ow">in</span> <span class="n">tubulins</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">remove_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">tub_type</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span> <span class="k">if</span> <span class="s2">&quot;A&quot;</span> <span class="ow">in</span> <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">tubulin</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;B&quot;</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span><span class="n">tubulin</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;tubulin</span><span class="si">{</span><span class="n">tub_type</span><span class="si">}</span><span class="s2">#free&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.topology_is_microtubule"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.topology_is_microtubule">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">topology_is_microtubule</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        does the topology have tubulins with ring bonds?</span>
<span class="sd">        if so it has multiple protofilaments and is not just an oligomer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">topology</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_vertices</span><span class="p">():</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;tubulin&quot;</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">vertex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">vertex</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.get_attaching_sites"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_attaching_sites">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_attaching_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the ring sites that just attached in a spatial reaction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sites1</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertices_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">site1</span> <span class="ow">in</span> <span class="n">sites1</span><span class="p">:</span>
            <span class="n">site2</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">site1</span><span class="p">,</span> <span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">site2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">site1</span><span class="p">,</span> <span class="n">site2</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.cancel_attach"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.cancel_attach">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cancel_attach</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">sites</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reverse an attach spatial reaction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">removed</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">try_remove_edge</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">sites</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sites</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">removed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">))</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="s2">&quot;Microtubule&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.tubulins_can_attach"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.tubulins_can_attach">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">tubulins_can_attach</span><span class="p">(</span><span class="n">tubulin_types</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if tubulins can attach laterally</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_polymer_offsets</span><span class="p">(</span><span class="n">tubulin_types</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.tubulin_is_crosslinked"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.tubulin_is_crosslinked">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">tubulin_is_crosslinked</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is the tubulin connected to a neighbor on each ring side?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.check_remove_tubulin_sites"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.check_remove_tubulin_sites">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">check_remove_tubulin_sites</span><span class="p">(</span>
        <span class="n">topology</span><span class="p">,</span>
        <span class="n">recipe</span><span class="p">,</span>
        <span class="n">tubulin</span><span class="p">,</span>
        <span class="n">tubulin_crosslinked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">neighbor_tubulin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">neighbor_crosslinked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if the tubulin&#39;s sites should be removed, if so remove them</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">tubulin_has_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">crosslinked</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">neighbor_tubulins</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">nt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">neighbor_tubulin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">neighbor_tubulins</span><span class="p">[</span><span class="n">nt</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertices_are_equal</span><span class="p">(</span>
                    <span class="n">topology</span><span class="p">,</span> <span class="n">neighbor_tubulins</span><span class="p">[</span><span class="n">nt</span><span class="p">],</span> <span class="n">neighbor_tubulin</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="n">crosslinked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neighbor_crosslinked</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">neighbor_tubulins</span><span class="p">[</span><span class="n">nt</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">crosslinked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">tubulin_is_crosslinked</span><span class="p">(</span>
                            <span class="n">topology</span><span class="p">,</span> <span class="n">neighbor_tubulins</span><span class="p">[</span><span class="n">nt</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">crosslinked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">False</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">crosslinked</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">tubulin_crosslinked</span>
            <span class="ow">or</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">tubulin_is_crosslinked</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">remove_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.tubulin_is_not_crosslinked"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.tubulin_is_not_crosslinked">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">tubulin_is_not_crosslinked</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        is the tubulin missing at least one ring side connection?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_tubulin_sites"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_tubulin_sites">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_tubulin_sites</span><span class="p">(</span>
        <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="n">site1_type</span><span class="o">=</span><span class="s2">&quot;site#new&quot;</span><span class="p">,</span> <span class="n">site2_type</span><span class="o">=</span><span class="s2">&quot;site#new&quot;</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add a new particle attached to the tubulin for each site</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pos_tub</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_position</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">append_particle</span><span class="p">(</span>
                <span class="p">[</span><span class="n">tubulin</span><span class="p">],</span>
                <span class="n">site1_type</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">site2_type</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="s2">&quot;site#new&quot;</span><span class="p">,</span>
                <span class="n">pos_tub</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]),</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.check_add_tubulin_sites"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.check_add_tubulin_sites">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">check_add_tubulin_sites</span><span class="p">(</span>
        <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="n">site1_type</span><span class="o">=</span><span class="s2">&quot;site#new&quot;</span><span class="p">,</span> <span class="n">site2_type</span><span class="o">=</span><span class="s2">&quot;site#new&quot;</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if the tubulin should have sites added, if so add them</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">tubulin_has_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">site1_type</span> <span class="o">==</span> <span class="s2">&quot;site#new&quot;</span> <span class="ow">and</span> <span class="n">site2_type</span> <span class="o">==</span> <span class="s2">&quot;site#new&quot;</span><span class="p">):</span>
                <span class="n">sites</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">site1_type</span> <span class="o">!=</span> <span class="s2">&quot;site#new&quot;</span><span class="p">:</span>
                    <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span><span class="n">sites</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">site1_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">site2_type</span> <span class="o">!=</span> <span class="s2">&quot;site#new&quot;</span><span class="p">:</span>
                    <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span><span class="n">sites</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">site2_type</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">add_tubulin_sites</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="n">site1_type</span><span class="p">,</span> <span class="n">site2_type</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.get_new_sites"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_new_sites">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_new_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get new site particles attached to a tubulin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v_new_sites</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbors_of_type</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="s2">&quot;site#&quot;</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">v_new_sites</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.setup_sites"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.setup_sites">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">setup_sites</span><span class="p">(</span>
        <span class="n">topology</span><span class="p">,</span>
        <span class="n">recipe</span><span class="p">,</span>
        <span class="n">v_new_sites</span><span class="p">,</span>
        <span class="n">position</span><span class="p">,</span>
        <span class="n">side</span><span class="p">,</span>
        <span class="n">normal</span><span class="p">,</span>
        <span class="n">tangent</span><span class="p">,</span>
        <span class="n">site_state_ring</span><span class="p">,</span>
        <span class="n">site_state_filament</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set positions, types, and intra-tubulin edges for new site particles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;site#out&quot;</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_position</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span> <span class="o">+</span> <span class="n">normal</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;site#1</span><span class="si">{</span><span class="n">site_state_ring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_position</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">position</span> <span class="o">+</span> <span class="n">side</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_new_sites</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># edge to site#out</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;site#2</span><span class="si">{</span><span class="n">site_state_ring</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_position</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">position</span> <span class="o">-</span> <span class="n">side</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_new_sites</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># edge to site#out</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;site#3&quot;</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_position</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">position</span> <span class="o">-</span> <span class="n">tangent</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_new_sites</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># edge to site#out</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v_new_sites</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># edge to site#1</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v_new_sites</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># edge to site#2</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;site#4</span><span class="si">{</span><span class="n">site_state_filament</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_position</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">position</span> <span class="o">+</span> <span class="n">tangent</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_new_sites</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># edge to site#out</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v_new_sites</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># edge to site#1</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_new_sites</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v_new_sites</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># edge to site#2</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.connect_sites_between_tubulins"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.connect_sites_between_tubulins">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">connect_sites_between_tubulins</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">v_sites_minus</span><span class="p">,</span> <span class="n">v_sites_plus</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add inter-tubulin edges between sites</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_sites_plus</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_sites_minus</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># + site0 -- - site0</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_sites_plus</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v_sites_minus</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># + site1 -- - site1</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_sites_plus</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v_sites_minus</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># + site2 -- - site2</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_sites_plus</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">v_sites_minus</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># + site3 -- - site4</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.get_all_polymer_tubulin_types"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_all_polymer_tubulin_types">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_all_polymer_tubulin_types</span><span class="p">(</span><span class="n">particle_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets a list of all polymer numbers</span>
<span class="sd">        (&quot;type1_1&quot;, &quot;type1_2&quot;, &quot;type1_3&quot;, &quot;type2_1&quot;, ... &quot;type3_3&quot;)</span>
<span class="sd">            for type particle_type</span>

<span class="sd">            returns list of types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">particle_type</span><span class="si">}{</span><span class="n">x</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_polymer_topology_species"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_polymer_topology_species">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_polymer_topology_species</span><span class="p">(</span><span class="n">particle_type</span><span class="p">,</span> <span class="n">diffCoeff</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        adds topology species for all polymer numbers</span>
<span class="sd">        (&quot;type1_1&quot;, &quot;type1_2&quot;, &quot;type1_3&quot;, &quot;type2_1&quot;, ... &quot;type3_3&quot;)</span>
<span class="sd">            for type particle_type</span>
<span class="sd">            with diffusion coefficient diffCoeff [nm^2/s]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">types</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_all_polymer_tubulin_types</span><span class="p">(</span><span class="n">particle_type</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">system</span><span class="o">.</span><span class="n">add_topology_species</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">diffCoeff</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.get_microtubule_positions_and_types"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_microtubule_positions_and_types">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_microtubule_positions_and_types</span><span class="p">(</span>
        <span class="n">n_filaments</span><span class="p">,</span>
        <span class="n">n_rings</span><span class="p">,</span>
        <span class="n">n_frayed_rings_plus</span><span class="p">,</span>
        <span class="n">n_frayed_rings_minus</span><span class="p">,</span>
        <span class="n">frayed_angle</span><span class="p">,</span>
        <span class="n">radius</span><span class="p">,</span>
        <span class="n">use_GTP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get lists of positions and types for particles in a microtubule</span>
<span class="sd">            with n_filaments protofilaments</span>
<span class="sd">            and n_rings rings</span>
<span class="sd">            and n_frayed_rings_plus rings at + end with outward bend</span>
<span class="sd">            and n_frayed_rings_minus rings at - end with outward bend</span>
<span class="sd">            and frayed_angle [radians] rotation of normal per bent tubulin</span>
<span class="sd">            and radius [nm]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">frayed_y_pos</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_frayed_rings_minus</span><span class="p">):</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="p">(</span><span class="n">ring</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">frayed_angle</span>
            <span class="n">quad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">angle</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">acute_angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">frayed_y_pos</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">quad</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">*</span> <span class="mi">4</span>
                <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">acute_angle</span><span class="p">)</span> <span class="k">if</span> <span class="n">quad</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">acute_angle</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">n_frayed_rings</span> <span class="o">=</span> <span class="n">n_frayed_rings_minus</span> <span class="o">+</span> <span class="n">n_frayed_rings_plus</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">filament</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_filaments</span><span class="p">):</span>
            <span class="n">tube_angle</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">n_filaments</span> <span class="o">-</span> <span class="n">filament</span>
            <span class="p">)</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">n_filaments</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="n">tube_normal</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tube_angle</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tube_angle</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="n">tube_tangent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
            <span class="n">side</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">tube_normal</span><span class="p">,</span> <span class="n">tube_tangent</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">n_frayed_rings</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">tangent</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tube_tangent</span><span class="p">),</span>
                    <span class="n">side</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">n_frayed_rings_minus</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">frayed_angle</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">normal</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tube_normal</span><span class="p">),</span>
                    <span class="n">side</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">n_frayed_rings_minus</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">frayed_angle</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tangent</span> <span class="o">=</span> <span class="n">tube_tangent</span>
                <span class="n">normal</span> <span class="o">=</span> <span class="n">tube_normal</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">radius</span> <span class="o">+</span> <span class="n">frayed_y_pos</span><span class="p">)</span> <span class="o">*</span> <span class="n">tube_normal</span> <span class="o">+</span> <span class="p">(</span>
                <span class="mf">12.0</span> <span class="o">/</span> <span class="mf">13.0</span> <span class="o">*</span> <span class="n">filament</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">n_rings</span>
            <span class="p">)</span> <span class="o">*</span> <span class="n">tube_tangent</span>
            <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rings</span><span class="p">):</span>
                <span class="n">number1</span> <span class="o">=</span> <span class="n">ring</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">number2</span> <span class="o">=</span> <span class="p">(</span><span class="n">filament</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ring</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">GTP_state</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;GTP&quot;</span>
                    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">ring</span> <span class="o">-</span> <span class="n">n_rings</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_rings</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
                    <span class="k">else</span> <span class="s2">&quot;GDP&quot;</span>
                <span class="p">)</span>
                <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
                <span class="n">bent</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ring</span> <span class="o">&lt;</span> <span class="n">n_frayed_rings_minus</span>
                    <span class="ow">or</span> <span class="n">ring</span> <span class="o">&gt;</span> <span class="n">n_rings</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">n_frayed_rings_plus</span>
                <span class="p">)</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="n">n_frayed_rings</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">ring</span> <span class="o">==</span> <span class="n">n_frayed_rings_minus</span>
                    <span class="ow">or</span> <span class="n">ring</span> <span class="o">==</span> <span class="n">n_rings</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">n_frayed_rings_plus</span>
                <span class="p">)</span>
                <span class="n">tub_type</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span> <span class="k">if</span> <span class="n">ring</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;B&quot;</span>
                <span class="n">bent_type</span> <span class="o">=</span> <span class="s2">&quot;bent_&quot;</span> <span class="k">if</span> <span class="n">bent</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">tub_GTP_state</span> <span class="o">=</span> <span class="n">GTP_state</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="k">if</span> <span class="n">use_GTP</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;tubulin</span><span class="si">{</span><span class="n">tub_type</span><span class="si">}</span><span class="s2">#</span><span class="si">{</span><span class="n">tub_GTP_state</span><span class="si">}{</span><span class="n">bent_type</span><span class="si">}{</span><span class="n">number1</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">number2</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">bent</span> <span class="ow">or</span> <span class="n">edge</span><span class="p">:</span>  <span class="c1"># needs site scaffolds</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;site#out&quot;</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">normal</span><span class="p">)</span>
                    <span class="n">site_state</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">GTP_state</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">edge</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;site#1</span><span class="si">{</span><span class="n">site_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">side</span><span class="p">)</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;site#2</span><span class="si">{</span><span class="n">site_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">side</span><span class="p">)</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;site#3&quot;</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">tangent</span><span class="p">)</span>
                    <span class="n">site_state</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">GTP_state</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">ring</span> <span class="o">==</span> <span class="n">n_rings</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;site#4</span><span class="si">{</span><span class="n">site_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">tangent</span><span class="p">)</span>
                    <span class="n">tangent</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span>
                        <span class="n">tangent</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="o">-</span><span class="n">frayed_angle</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="k">if</span> <span class="n">edge</span> <span class="k">else</span> <span class="mf">1.0</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">normal</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span>
                        <span class="n">normal</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="o">-</span><span class="n">frayed_angle</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="k">if</span> <span class="n">edge</span> <span class="k">else</span> <span class="mf">1.0</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">tangent</span>
        <span class="k">return</span> <span class="n">positions</span><span class="p">,</span> <span class="n">types</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_edges"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_edges">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_edges</span><span class="p">(</span>
        <span class="n">microtubule</span><span class="p">,</span> <span class="n">n_filaments</span><span class="p">,</span> <span class="n">n_rings</span><span class="p">,</span> <span class="n">n_frayed_rings_plus</span><span class="p">,</span> <span class="n">n_frayed_rings_minus</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add edges to a microtubule topology</span>
<span class="sd">            with n_filaments protofilaments</span>
<span class="sd">            and n_rings rings</span>
<span class="sd">            and n_frayed_rings_plus rings at + end with outward bend</span>
<span class="sd">            and n_frayed_rings_minus rings at - end with outward bend</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sites_per_scaffold</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">n_frayed_rings</span> <span class="o">=</span> <span class="n">n_frayed_rings_minus</span> <span class="o">+</span> <span class="n">n_frayed_rings_plus</span>
        <span class="n">particles_per_filament</span> <span class="o">=</span> <span class="n">n_rings</span> <span class="o">+</span> <span class="n">sites_per_scaffold</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">n_frayed_rings</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="k">if</span> <span class="n">n_frayed_rings</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">total_particles</span> <span class="o">=</span> <span class="n">n_filaments</span> <span class="o">*</span> <span class="n">particles_per_filament</span>
        <span class="k">for</span> <span class="n">filament</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_filaments</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rings</span><span class="p">):</span>
                <span class="n">end</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;minus&quot;</span>
                    <span class="k">if</span> <span class="n">n_frayed_rings_minus</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ring</span> <span class="o">&lt;=</span> <span class="n">n_frayed_rings_minus</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span> <span class="s2">&quot;plus&quot;</span>
                <span class="p">)</span>
                <span class="n">bent</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ring</span> <span class="o">&lt;</span> <span class="n">n_frayed_rings_minus</span>
                    <span class="ow">or</span> <span class="n">ring</span> <span class="o">&gt;</span> <span class="n">n_rings</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">n_frayed_rings_plus</span>
                <span class="p">)</span>
                <span class="n">edge</span> <span class="o">=</span> <span class="n">n_frayed_rings</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">ring</span> <span class="o">==</span> <span class="n">n_frayed_rings_minus</span>
                    <span class="ow">or</span> <span class="n">ring</span> <span class="o">==</span> <span class="n">n_rings</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">n_frayed_rings_plus</span>
                <span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">filament</span> <span class="o">*</span> <span class="n">particles_per_filament</span>
                    <span class="o">+</span> <span class="n">ring</span>
                    <span class="o">+</span> <span class="n">sites_per_scaffold</span>
                    <span class="o">*</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">ring</span> <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="s2">&quot;minus&quot;</span> <span class="k">else</span> <span class="n">n_frayed_rings_minus</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">n_frayed_rings_minus</span> <span class="o">&gt;</span> <span class="mi">0</span>
                        <span class="k">else</span> <span class="mi">0</span>
                    <span class="p">)</span>
                    <span class="o">+</span> <span class="n">sites_per_scaffold</span>
                    <span class="o">*</span> <span class="p">(</span>
                        <span class="n">ring</span> <span class="o">-</span> <span class="p">((</span><span class="n">n_rings</span> <span class="o">-</span> <span class="n">n_frayed_rings_plus</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="s2">&quot;plus&quot;</span> <span class="ow">and</span> <span class="n">bent</span>
                        <span class="k">else</span> <span class="mi">0</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">ring</span> <span class="o">&lt;</span> <span class="n">n_rings</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># bond along filament</span>
                    <span class="n">i_filament</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">sites_per_scaffold</span> <span class="k">if</span> <span class="n">bent</span> <span class="ow">or</span> <span class="n">edge</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i_filament</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">bent</span><span class="p">:</span>  <span class="c1"># bond along ring</span>
                    <span class="c1"># as long as not in + end overhang</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                        <span class="n">filament</span> <span class="o">==</span> <span class="n">n_filaments</span> <span class="o">-</span> <span class="mi">1</span>
                        <span class="ow">and</span> <span class="n">ring</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">n_rings</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">n_frayed_rings_plus</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span>
                    <span class="p">):</span>
                        <span class="n">i_ring</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">particles_per_filament</span>
                        <span class="k">if</span> <span class="n">filament</span> <span class="o">==</span> <span class="n">n_filaments</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">i_ring</span> <span class="o">+=</span> <span class="p">(</span>
                                <span class="mi">8</span> <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="s2">&quot;minus&quot;</span> <span class="ow">and</span> <span class="n">edge</span> <span class="k">else</span> <span class="mi">3</span>
                            <span class="p">)</span> <span class="o">-</span> <span class="n">total_particles</span>
                        <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i_ring</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bent</span> <span class="ow">or</span> <span class="n">edge</span><span class="p">:</span>  <span class="c1"># bent site bonds</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># tub -- site0</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># tub -- site1</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># tub -- site2</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># tub -- site3</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># tub -- site4</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># site0 -- site1</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># site0 -- site2</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># site0 -- site3</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># site0 -- site4</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># site1 -- site3</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># site1 -- site4</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># site2 -- site3</span>
                    <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># site2 -- site4</span>
                    <span class="c1"># longitudinal bonds on bent rings</span>
                    <span class="k">if</span> <span class="n">ring</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">bent</span> <span class="ow">or</span> <span class="p">(</span><span class="n">edge</span> <span class="ow">and</span> <span class="n">end</span> <span class="o">==</span> <span class="s2">&quot;minus&quot;</span><span class="p">)):</span>
                        <span class="c1"># site0 -- prev site0</span>
                        <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
                        <span class="c1"># site1 -- prev site1</span>
                        <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="c1"># site2 -- prev site2</span>
                        <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>
                        <span class="c1"># site3 -- prev site4</span>
                        <span class="n">microtubule</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_microtubule"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_microtubule">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_microtubule</span><span class="p">(</span>
        <span class="n">n_rings</span><span class="p">,</span>
        <span class="n">n_frayed_rings_minus</span><span class="p">,</span>
        <span class="n">n_frayed_rings_plus</span><span class="p">,</span>
        <span class="n">position_offset</span><span class="p">,</span>
        <span class="n">simulation</span><span class="p">,</span>
        <span class="n">use_GTP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add seed microtubule to the simulation</span>
<span class="sd">            with n_filaments protofilaments</span>
<span class="sd">            and n_rings rings</span>
<span class="sd">            and n_frayed_rings_minus rings at - end with outward bend</span>
<span class="sd">            and n_frayed_rings_plus rings at + end with outward bend</span>
<span class="sd">            and position_offset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_rings</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_frayed_rings_minus</span> <span class="o">+</span> <span class="n">n_frayed_rings_plus</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Too many frayed rings, &quot;</span> <span class="s2">&quot;protofilaments will not form a microtubule&quot;</span>
            <span class="p">)</span>
        <span class="n">n_filaments</span> <span class="o">=</span> <span class="mi">13</span>
        <span class="n">frayed_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="n">max_frayed_rings</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="mf">360.0</span> <span class="o">+</span> <span class="n">frayed_angle</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">frayed_angle</span><span class="p">)</span>
        <span class="n">n_frayed_rings_minus</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_frayed_rings</span><span class="p">,</span> <span class="n">n_frayed_rings_minus</span><span class="p">)</span>
        <span class="n">n_frayed_rings_plus</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_frayed_rings</span><span class="p">,</span> <span class="n">n_frayed_rings_plus</span><span class="p">)</span>
        <span class="n">positions</span><span class="p">,</span> <span class="n">types</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_microtubule_positions_and_types</span><span class="p">(</span>
            <span class="n">n_filaments</span><span class="p">,</span>
            <span class="n">n_rings</span><span class="p">,</span>
            <span class="n">n_frayed_rings_plus</span><span class="p">,</span>
            <span class="n">n_frayed_rings_minus</span><span class="p">,</span>
            <span class="n">frayed_angle</span><span class="p">,</span>
            <span class="mf">10.86</span><span class="p">,</span>
            <span class="n">use_GTP</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">microtubule</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_topology</span><span class="p">(</span>
            <span class="s2">&quot;Microtubule&quot;</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">positions</span> <span class="o">+</span> <span class="n">position_offset</span>
        <span class="p">)</span>
        <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span>
            <span class="n">microtubule</span><span class="p">,</span> <span class="n">n_filaments</span><span class="p">,</span> <span class="n">n_rings</span><span class="p">,</span> <span class="n">n_frayed_rings_plus</span><span class="p">,</span> <span class="n">n_frayed_rings_minus</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_tubulin_dimers"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_tubulin_dimers">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_tubulin_dimers</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="n">n_tubulin</span><span class="p">,</span> <span class="n">box_size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add seed tubulin dimers to the simulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_tubulin</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">box_size</span> <span class="o">-</span> <span class="n">box_size</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)):</span>
            <span class="n">to_B</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()])</span>
            <span class="p">)</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">add_topology</span><span class="p">(</span>
                <span class="s2">&quot;Dimer&quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="s2">&quot;tubulinA#free&quot;</span><span class="p">,</span> <span class="s2">&quot;tubulinB#free&quot;</span><span class="p">],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">positions</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">positions</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">+</span> <span class="n">to_B</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="n">top</span><span class="o">.</span><span class="n">get_graph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_tubulin_types"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_tubulin_types">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_tubulin_types</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">diffCoeff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add tubulin topology and particle types to the system</span>

<span class="sd">        microtubules are 2D polymers and to encode polarity in each dimension,</span>
<span class="sd">        there are 3 x 3 = 9 polymer types. These are represented as &quot;type#x_y&quot;</span>
<span class="sd">        where x and y are both in [1,3]. spatially, the types are mapped like so:</span>

<span class="sd">                                  x_(y+1)</span>
<span class="sd">                                   /</span>
<span class="sd">                            A ____/____ B</span>
<span class="sd">                            /   /    /</span>
<span class="sd">        - end     (x-1)_y__/___x_y__/_____(x+1)_y     + end</span>
<span class="sd">                          /   /    /</span>
<span class="sd">                         /___/____/</span>
<span class="sd">                     C     /     D</span>
<span class="sd">                          /</span>
<span class="sd">                      x_(y-1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Dimer&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">add_topology_species</span><span class="p">(</span><span class="s2">&quot;tubulinA#free&quot;</span><span class="p">,</span> <span class="n">diffCoeff</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">add_topology_species</span><span class="p">(</span><span class="s2">&quot;tubulinB#free&quot;</span><span class="p">,</span> <span class="n">diffCoeff</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Oligomer&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Oligomer#Fail-Shrink-GTP&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Oligomer#Fail-Shrink-GDP&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Growing1-GTP&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Growing1-GDP&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Growing2-GTP&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Growing2-GDP&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Shrinking&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Fail-Shrink-GTP&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Fail-Shrink-GDP&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Attaching&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Fail-Attach&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Detaching-GTP&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Detaching-GDP&quot;</span><span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Fail-Hydrolyze&quot;</span><span class="p">)</span>
        <span class="n">tube_tubulin_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;tubulinA#GTP_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinA#GDP_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#GTP_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#GDP_&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">bent_tubulin_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;tubulinA#GTP_bent_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinA#GDP_bent_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#GTP_bent_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#GDP_bent_&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">all_tubulin_types</span> <span class="o">=</span> <span class="n">tube_tubulin_types</span> <span class="o">+</span> <span class="n">bent_tubulin_types</span>
        <span class="k">for</span> <span class="n">tubulin_type</span> <span class="ow">in</span> <span class="n">all_tubulin_types</span><span class="p">:</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">add_polymer_topology_species</span><span class="p">(</span>
                <span class="n">tubulin_type</span><span class="p">,</span> <span class="n">diffCoeff</span><span class="p">,</span> <span class="n">system</span>
            <span class="p">)</span>
        <span class="n">site_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;site#out&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#1_detach&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#2_detach&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;site#new&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">system</span><span class="o">.</span><span class="n">add_species</span><span class="p">(</span><span class="s2">&quot;site#remove&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">site_type</span> <span class="ow">in</span> <span class="n">site_types</span><span class="p">:</span>
            <span class="n">system</span><span class="o">.</span><span class="n">add_topology_species</span><span class="p">(</span><span class="n">site_type</span><span class="p">,</span> <span class="n">diffCoeff</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.get_all_tubulin_types"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.get_all_tubulin_types">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_all_tubulin_types</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the list of all tubulin types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tube_tubulin_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;tubulinA#GTP_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinA#GDP_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#GTP_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#GDP_&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">bent_tubulin_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;tubulinA#GTP_bent_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinA#GDP_bent_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#GTP_bent_&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#GDP_bent_&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">all_tubulin_types</span> <span class="o">=</span> <span class="n">tube_tubulin_types</span> <span class="o">+</span> <span class="n">bent_tubulin_types</span>
        <span class="k">return</span> <span class="n">all_tubulin_types</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.do_grow1"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.do_grow1">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">do_grow1</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">GTP_state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start adding a tubulin dimer to the end of a protofilament:</span>
<span class="sd">        add additional particles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Grow 1&quot;</span><span class="p">)</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">readdy</span><span class="o">.</span><span class="n">StructuralReactionRecipe</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
        <span class="n">v_newB</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_of_type</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#free&quot;</span><span class="p">,</span>
            <span class="kc">True</span><span class="p">,</span>
            <span class="n">error_msg</span><span class="o">=</span><span class="s2">&quot;Failed to find tubulinB#free vertex&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">v_newA</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">v_newB</span><span class="p">,</span> <span class="s2">&quot;tubulinA#free&quot;</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">v_newA</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to find tubulinA#free vertex</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">add_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">v_newB</span><span class="p">)</span>
        <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">add_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">v_newA</span><span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Microtubule#Growing2-</span><span class="si">{</span><span class="n">GTP_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">recipe</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_grow1_GTP"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_grow1_GTP">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_grow1_GTP</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start adding a tubulin dimer to the end of a protofilament:</span>
<span class="sd">        add additional particles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">do_grow1</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="s2">&quot;GTP&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_grow1_GDP"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_grow1_GDP">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_grow1_GDP</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start adding a tubulin dimer to the end of a protofilament:</span>
<span class="sd">        add additional particles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">do_grow1</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="s2">&quot;GDP&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.do_grow2"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.do_grow2">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">do_grow2</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        finish adding a tubulin dimer to the end of a protofilament:</span>
<span class="sd">        set types, positions, and edges</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">readdy</span><span class="o">.</span><span class="n">StructuralReactionRecipe</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Grow 2&quot;</span><span class="p">)</span>
        <span class="n">v_newB</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_of_type</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#free&quot;</span><span class="p">,</span>
            <span class="kc">True</span><span class="p">,</span>
            <span class="n">error_msg</span><span class="o">=</span><span class="s2">&quot;Failed to find tubulinB#free vertex&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">v_newA</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">v_newB</span><span class="p">,</span> <span class="s2">&quot;tubulinA#free&quot;</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">v_newA</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to find tubulinA#free vertex</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">v_site4</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">v_newA</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_site4</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to find site#4 vertex</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">v_endB</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">v_site4</span><span class="p">,</span> <span class="s2">&quot;tubulinB&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_endB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to find neighboring tubulin vertex</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">v_sites</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">v_endB</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_sites</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;TubulinB at end does not have sites!</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">v_new_sitesB</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbors_of_type</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">v_newB</span><span class="p">,</span> <span class="s2">&quot;site#new&quot;</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_new_sitesB</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v_new_sitesB</span><span class="p">)</span><span class="si">}</span><span class="s2"> new particles on tubulinB, expected 5</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">v_new_sitesA</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbors_of_type</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">v_newA</span><span class="p">,</span> <span class="s2">&quot;site#new&quot;</span><span class="p">,</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_new_sitesA</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v_new_sitesA</span><span class="p">)</span><span class="si">}</span><span class="s2"> new particles on tubulinA, expected 5</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">pos_endB</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_position</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">v_endB</span><span class="p">)</span>
        <span class="n">pos_site0</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_position</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">v_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">pos_site1</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_position</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">v_sites</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">pos_site1</span> <span class="o">-</span> <span class="n">pos_endB</span><span class="p">)</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">pos_site0</span> <span class="o">-</span> <span class="n">pos_endB</span><span class="p">)</span>
        <span class="n">tangent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">side</span><span class="p">)</span>
        <span class="c1"># remove temporary edge (site#4--tubulinA#free)]</span>
        <span class="n">removed</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">try_remove_edge</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">v_sites</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">v_newA</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">removed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">))</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">v_endB</span><span class="p">,</span> <span class="n">v_newA</span><span class="p">)</span>  <span class="c1"># endB -- newA</span>
        <span class="c1"># new tubulinA</span>
        <span class="n">tangent</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tangent</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">normal</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span>
        <span class="n">pos_newA</span> <span class="o">=</span> <span class="n">pos_endB</span> <span class="o">+</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">tangent</span>
        <span class="n">polymer_indicesA</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">increment_polymer_indices</span><span class="p">(</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_polymer_indices</span><span class="p">(</span>
                <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">v_endB</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span>
            <span class="n">v_newA</span><span class="p">,</span>
            <span class="s2">&quot;tubulinA#GTP_bent&quot;</span>
            <span class="o">+</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">polymer_indices_to_string</span><span class="p">(</span><span class="n">polymer_indicesA</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_position</span><span class="p">(</span><span class="n">v_newA</span><span class="p">,</span> <span class="n">pos_newA</span><span class="p">)</span>
        <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">setup_sites</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">v_new_sitesA</span><span class="p">,</span> <span class="n">pos_newA</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">tangent</span><span class="p">,</span> <span class="s2">&quot;_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">connect_sites_between_tubulins</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">v_sites</span><span class="p">,</span> <span class="n">v_new_sitesA</span>
        <span class="p">)</span>
        <span class="c1"># new tubulinB</span>
        <span class="n">tangent</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tangent</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">normal</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span>
        <span class="n">pos_newB</span> <span class="o">=</span> <span class="n">pos_newA</span> <span class="o">+</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">tangent</span>
        <span class="n">polymer_indicesB</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">increment_polymer_indices</span><span class="p">(</span>
            <span class="n">polymer_indicesA</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span>
            <span class="n">v_newB</span><span class="p">,</span>
            <span class="s2">&quot;tubulinB#GTP_bent&quot;</span>
            <span class="o">+</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">polymer_indices_to_string</span><span class="p">(</span><span class="n">polymer_indicesB</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_position</span><span class="p">(</span><span class="n">v_newB</span><span class="p">,</span> <span class="n">pos_newB</span><span class="p">)</span>
        <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">setup_sites</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span>
            <span class="n">recipe</span><span class="p">,</span>
            <span class="n">v_new_sitesB</span><span class="p">,</span>
            <span class="n">pos_newB</span><span class="p">,</span>
            <span class="n">side</span><span class="p">,</span>
            <span class="n">normal</span><span class="p">,</span>
            <span class="n">tangent</span><span class="p">,</span>
            <span class="s2">&quot;_GTP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;_GTP&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">connect_sites_between_tubulins</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">v_new_sitesA</span><span class="p">,</span> <span class="n">v_new_sitesB</span>
        <span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="s2">&quot;Microtubule&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">recipe</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_grow2_GTP"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_grow2_GTP">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_grow2_GTP</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        finish adding a tubulin dimer to the end of a protofilament:</span>
<span class="sd">        set types, positions, and edges</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">do_grow2</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_grow2_GDP"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_grow2_GDP">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_grow2_GDP</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        finish adding a tubulin dimer to the end of a protofilament:</span>
<span class="sd">        set types, positions, and edges</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">do_grow2</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.do_shrink1"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.do_shrink1">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">do_shrink1</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">GTP_state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start removing a tubulin dimer from the end of a protofilament:</span>
<span class="sd">        remove or detach particles, change particle types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shrink&quot;</span><span class="p">)</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">readdy</span><span class="o">.</span><span class="n">StructuralReactionRecipe</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
        <span class="n">tubulins</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_random_tubulin_neighbors</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;B#&quot;</span><span class="p">,</span> <span class="s2">&quot;bent&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;A#&quot;</span><span class="p">,</span> <span class="s2">&quot;bent&quot;</span><span class="p">]],</span> <span class="p">[[],</span> <span class="p">[]],</span> <span class="n">GTP_state</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">tubulins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topology</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">#Fail-Shrink-</span><span class="si">{</span><span class="n">GTP_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Shrink cancelled: Couldn&#39;t find &quot;</span>
                    <span class="s2">&quot;2 bent tubulin vertices to separate&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">recipe</span>
        <span class="c1"># are both fragments crosslinked to other filaments?</span>
        <span class="k">if</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">filament_is_crosslinked</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">filament_is_crosslinked</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topology</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">#Fail-Shrink-</span><span class="si">{</span><span class="n">GTP_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Shrink cancelled: both fragments (starting at &quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot; and &quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;) are crosslinked&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">recipe</span>
        <span class="c1"># will either of the cut fragments be a dimer?</span>
        <span class="n">is_dimer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filament_lengths</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_filament_lengths</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tubulins</span><span class="p">)):</span>
            <span class="n">is_dimer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filament_lengths</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimer</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">site4</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="kc">False</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">site4</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Shrink cancelled: Couldn&#39;t find site4 to set reactive</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># if both fragments are bigger than dimers, just disconnect them</span>
        <span class="k">if</span> <span class="kc">True</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">is_dimer</span><span class="p">:</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">remove_bent_filament_site_bonds</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="c1"># detach at least one dimer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tubulins_to_detach</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tubulins</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimer</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="n">tubulins_to_detach</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">tubulins_to_detach</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
                        <span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">set_free</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulins_to_detach</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to find sites for tubulins being released</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="n">removed</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">try_remove_edge</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">removed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">))</span>
        <span class="c1"># make the new plus end reactive</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimer</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span><span class="n">site4</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;site#4_</span><span class="si">{</span><span class="n">GTP_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># remove sites from the new minus end of the second fragment</span>
        <span class="c1"># if it&#39;s not a dimer and it and its plus neighbor</span>
        <span class="c1"># are both fully attached laterally</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_dimer</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">check_remove_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="s2">&quot;Microtubule#Shrinking&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">recipe</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_shrink_GTP"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_shrink_GTP">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_shrink_GTP</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start removing a tubulin dimer from the end of a protofilament:</span>
<span class="sd">        remove or detach particles, change particle types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">do_shrink1</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="s2">&quot;GTP&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_shrink_GDP"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_shrink_GDP">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_shrink_GDP</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        start removing a tubulin dimer from the end of a protofilament:</span>
<span class="sd">        remove or detach particles, change particle types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">do_shrink1</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="s2">&quot;GDP&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_shrink2"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_shrink2">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_shrink2</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        finish removing a tubulin dimer from the end of a protofilament:</span>
<span class="sd">        change topology types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">readdy</span><span class="o">.</span><span class="n">StructuralReactionRecipe</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">topology</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_vertices</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="s2">&quot;Dimer&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">topology_is_microtubule</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="s2">&quot;Microtubule&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="s2">&quot;Oligomer&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">recipe</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_attach"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_attach">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_attach</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        attach tubulins laterally</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Attach&quot;</span><span class="p">)</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">readdy</span><span class="o">.</span><span class="n">StructuralReactionRecipe</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
        <span class="n">attaching_sites</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_attaching_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attaching_sites</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Failed to find attaching vertices</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">tubulins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">attaching_sites</span><span class="p">:</span>
            <span class="n">tubulins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="s2">&quot;tubulin&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">tubulins</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tubulins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Attach cancelled: failed to find attaching site&#39;s &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span><span class="si">}</span><span class="s2">) tubulin</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># make sure sites don&#39;t belong to same tubulin</span>
        <span class="n">tubulin_ids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">topology</span><span class="o">.</span><span class="n">particle_id_of_vertex</span><span class="p">(</span><span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">topology</span><span class="o">.</span><span class="n">particle_id_of_vertex</span><span class="p">(</span><span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">tubulin_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">tubulin_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">cancel_attach</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">attaching_sites</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Attach cancelled: sites (&quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">attaching_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">attaching_sites</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;) were on same tubulin (&quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">recipe</span>
        <span class="c1"># make sure sites belong to tubulins that can attach</span>
        <span class="n">tubulin_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">tubulins_can_attach</span><span class="p">(</span><span class="n">tubulin_types</span><span class="p">):</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">cancel_attach</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">attaching_sites</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Attach cancelled: tubulins (&quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="o">+</span> <span class="s2">&quot;) can&#39;t attach&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">recipe</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">crosslinked</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
                    <span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">crosslinked</span><span class="p">:</span>
                <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">check_remove_tubulin_sites</span><span class="p">(</span>
                    <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[</span><span class="s2">&quot;bent&quot;</span><span class="p">])</span>
            <span class="n">prev_tubulin</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">prev_tubulin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">check_remove_tubulin_sites</span><span class="p">(</span>
                    <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">prev_tubulin</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">crosslinked</span>
                <span class="p">)</span>
            <span class="n">next_tubulin</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">next_tubulin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">check_remove_tubulin_sites</span><span class="p">(</span>
                    <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">next_tubulin</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">crosslinked</span>
                <span class="p">)</span>
        <span class="n">removed</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">try_remove_edge</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">attaching_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">attaching_sites</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">removed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">))</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="s2">&quot;Microtubule&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">recipe</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_detach1"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_detach1">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_detach1</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add new sites in preparation to detach tubulins laterally</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Detach&quot;</span><span class="p">)</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">readdy</span><span class="o">.</span><span class="n">StructuralReactionRecipe</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
        <span class="n">GTP_state</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;GTP&quot;</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                <span class="o">&lt;=</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ring_detach_GTP_rate&quot;</span><span class="p">]</span>
                <span class="o">/</span> <span class="p">(</span>
                    <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ring_detach_GTP_rate&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ring_detach_GDP_rate&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">else</span> <span class="s2">&quot;GDP&quot;</span>
        <span class="p">)</span>
        <span class="n">detaching_tubulins</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_random_tubulin_neighbors</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span>
            <span class="p">[[</span><span class="s2">&quot;tubulin&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;tubulin&quot;</span><span class="p">]],</span>
            <span class="p">[[</span><span class="s2">&quot;bent&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;bent&quot;</span><span class="p">]],</span>
            <span class="n">GTP_state</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">detaching_tubulins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Detach cancelled: Couldn&#39;t find 2 tubulin vertices to detach&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">recipe</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">check_add_tubulin_sites</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span>
                <span class="n">recipe</span><span class="p">,</span>
                <span class="n">detaching_tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;site#new&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;site#1_detach&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_detach&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;site#new&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
                    <span class="n">topology</span><span class="p">,</span> <span class="n">detaching_tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span>
                    <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">detaching_tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;bent&quot;</span><span class="p">],</span> <span class="p">[]</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">neighbor_tubulin</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
                    <span class="n">topology</span><span class="p">,</span> <span class="n">detaching_tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">neighbor_tubulin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">check_add_tubulin_sites</span><span class="p">(</span>
                        <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">neighbor_tubulin</span>
                    <span class="p">)</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Microtubule#Detaching-</span><span class="si">{</span><span class="n">GTP_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">recipe</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_detach2"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_detach2">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_detach2</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        detach tubulins laterally</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">readdy</span><span class="o">.</span><span class="n">StructuralReactionRecipe</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
        <span class="n">detaching_sites</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_of_type</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span>
                <span class="s2">&quot;site#2_detach&quot;</span><span class="p">,</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">error_msg</span><span class="o">=</span><span class="s2">&quot;Failed to find detaching sites&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_of_type</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span>
                <span class="s2">&quot;site#1_detach&quot;</span><span class="p">,</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="n">error_msg</span><span class="o">=</span><span class="s2">&quot;Failed to find detaching sites&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>
        <span class="n">detaching_tubulins</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">detaching_sites</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;tubulin&quot;</span><span class="p">,</span> <span class="kc">False</span>
            <span class="p">),</span>
            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_neighbor_of_type</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">detaching_sites</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;tubulin&quot;</span><span class="p">,</span> <span class="kc">False</span>
            <span class="p">),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">detaching_tubulins</span><span class="p">:</span>
            <span class="n">tub0</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;None&quot;</span>
                <span class="k">if</span> <span class="n">detaching_tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">detaching_tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="n">tub1</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;None&quot;</span>
                <span class="k">if</span> <span class="n">detaching_tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">detaching_tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to find detaching tubulins (</span><span class="si">{</span><span class="n">tub0</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">tub1</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">tubulins</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
                    <span class="n">topology</span><span class="p">,</span> <span class="n">detaching_tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">detaching_tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
                    <span class="n">topology</span><span class="p">,</span> <span class="n">detaching_tubulins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="p">),</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Tubulin has no neighbors on filament?!</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="n">pos_tubulin</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_position</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">pos_filament</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_position</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">pos_ring</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_position</span><span class="p">(</span>
                <span class="n">topology</span><span class="p">,</span> <span class="n">detaching_tubulins</span><span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">frayed_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
            <span class="n">tangent</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span>
                <span class="n">pos_tubulin</span> <span class="o">-</span> <span class="n">pos_filament</span>
            <span class="p">)</span>
            <span class="n">side</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">pos_ring</span> <span class="o">-</span> <span class="n">pos_tubulin</span><span class="p">)</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tangent</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">side</span><span class="p">))</span>
            <span class="n">sites</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">added_sites</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">tangent</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tangent</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">frayed_angle</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">normal</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">normal</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">frayed_angle</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">tubulin_state</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;_GTP&quot;</span>
                        <span class="k">if</span> <span class="s2">&quot;GTP&quot;</span> <span class="ow">in</span> <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">tubulins</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span> <span class="s2">&quot;_GDP&quot;</span>
                    <span class="p">)</span>
                    <span class="n">site_state_ring</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">tubulin_state</span>
                        <span class="k">if</span> <span class="s2">&quot;bent&quot;</span> <span class="ow">in</span> <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">tubulins</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_new_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                                <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">vertex_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; is missing sites [</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
                                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
                            <span class="p">)</span>
                        <span class="n">added_sites</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">site_state_filament</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">tubulin_state</span>
                            <span class="k">if</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_neighboring_tubulin</span><span class="p">(</span>
                                <span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="ow">is</span> <span class="kc">None</span>
                            <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                        <span class="p">)</span>
                        <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">setup_sites</span><span class="p">(</span>
                            <span class="n">topology</span><span class="p">,</span>
                            <span class="n">recipe</span><span class="p">,</span>
                            <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                            <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_vertex_position</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulins</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span>
                            <span class="n">side</span><span class="p">,</span>
                            <span class="n">normal</span><span class="p">,</span>
                            <span class="n">tangent</span><span class="p">,</span>
                            <span class="n">site_state_ring</span><span class="p">,</span>
                            <span class="n">site_state_filament</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                                <span class="s2">&quot;A ring site was None!</span><span class="se">\n</span><span class="s2">&quot;</span>
                                <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
                            <span class="p">)</span>
                        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span>
                            <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;site#1</span><span class="si">{</span><span class="n">site_state_ring</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="n">recipe</span><span class="o">.</span><span class="n">change_particle_type</span><span class="p">(</span>
                            <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;site#2</span><span class="si">{</span><span class="n">site_state_ring</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">sites</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="n">added_sites</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">added_sites</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="p">):</span>
                    <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">connect_sites_between_tubulins</span><span class="p">(</span>
                        <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">sites</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sites</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="p">)</span>
        <span class="n">removed</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">try_remove_edge</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">detaching_tubulins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">detaching_tubulins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">removed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">topology_to_string</span><span class="p">(</span><span class="n">topology</span><span class="p">))</span>
        <span class="n">recipe</span><span class="o">.</span><span class="n">change_topology_type</span><span class="p">(</span><span class="s2">&quot;Microtubule&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">recipe</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.reaction_function_hydrolyze"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.reaction_function_hydrolyze">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">reaction_function_hydrolyze</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        hydrolyze GTP to GDP in a random tubulin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hydrolyze&quot;</span><span class="p">)</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">readdy</span><span class="o">.</span><span class="n">StructuralReactionRecipe</span><span class="p">(</span><span class="n">topology</span><span class="p">)</span>
        <span class="n">tubulin</span> <span class="o">=</span> <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">get_random_vertex_of_type</span><span class="p">(</span>
            <span class="n">topology</span><span class="p">,</span>
            <span class="s2">&quot;#GTP&quot;</span><span class="p">,</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Hydrolyze cancelled: Couldn&#39;t find GTP-tubulin&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">tubulin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">recipe</span>
        <span class="n">sites</span> <span class="o">=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_tubulin_sites</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sites</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;GTP&quot;</span> <span class="ow">in</span> <span class="n">topology</span><span class="o">.</span><span class="n">particle_type_of_vertex</span><span class="p">(</span><span class="n">sites</span><span class="p">[</span><span class="n">s</span><span class="p">]):</span>
                    <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">sites</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;GDP&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;GTP&quot;</span><span class="p">])</span>
        <span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">recipe</span><span class="p">,</span> <span class="n">tubulin</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;GDP&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;GTP&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">recipe</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.rate_function_shrink_GTP"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.rate_function_shrink_GTP">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rate_function_shrink_GTP</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rate function for removing a GTP-tubulin dimer from the end of a protofilament</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;protofilament_shrink_GTP_rate&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.rate_function_shrink_GDP"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.rate_function_shrink_GDP">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rate_function_shrink_GDP</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rate function for removing a GDP-tubulin dimer from the end of a protofilament</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;protofilament_shrink_GDP_rate&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.rate_function_detach_ring"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.rate_function_detach_ring">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rate_function_detach_ring</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rate function for detaching protofilaments laterally</span>
<span class="sd">        at ring sites for GTP-tubulin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ring_detach_GTP_rate&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;ring_detach_GDP_rate&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.rate_function_hydrolyze"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.rate_function_hydrolyze">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">rate_function_hydrolyze</span><span class="p">(</span><span class="n">topology</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rate function for hydrolyzing GTP to GDP in tubulin Bs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;hydrolyze_rate&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_bonds_between_tubulins"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_bonds_between_tubulins">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_bonds_between_tubulins</span><span class="p">(</span><span class="n">tubulin_types</span><span class="p">,</span> <span class="n">force_constant</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">util</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add bonds between tubulins</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_bond_2D</span><span class="p">(</span>  <span class="c1"># bonds between protofilaments</span>
            <span class="n">tubulin_types</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tubulin_types</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">force_constant</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="n">system</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_bond_2D</span><span class="p">(</span>  <span class="c1"># bonds between rings</span>
            <span class="n">tubulin_types</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tubulin_types</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">force_constant</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">system</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>  <span class="c1"># dimer bond and temporary bond</span>
            <span class="p">[</span><span class="s2">&quot;tubulinB#free&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;tubulinA#free&quot;</span><span class="p">],</span> <span class="n">force_constant</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">system</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_tubulin_site_bonds"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_tubulin_site_bonds">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_tubulin_site_bonds</span><span class="p">(</span><span class="n">tubulin_types</span><span class="p">,</span> <span class="n">site_types</span><span class="p">,</span> <span class="n">force_constant</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">util</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add bonds between a tubulin and its sites</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_bond_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">site_types</span><span class="p">,</span> <span class="p">[],</span> <span class="n">force_constant</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">system</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;tubulinA#free&quot;</span><span class="p">,</span> <span class="s2">&quot;tubulinB#free&quot;</span><span class="p">],</span> <span class="n">site_types</span><span class="p">,</span> <span class="n">force_constant</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">system</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_detach&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_detach&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.12</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.12</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_detach&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_detach&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.12</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>  <span class="c1"># temporary (grow reactions)</span>
            <span class="p">[</span><span class="s2">&quot;tubulinA#free&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">system</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>  <span class="c1"># temporary (attach reactions)</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_detach&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_detach&quot;</span><span class="p">],</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="mf">2.5</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>  <span class="c1"># temporary (detach reactions)</span>
            <span class="p">[</span><span class="s2">&quot;site#new&quot;</span><span class="p">],</span> <span class="n">site_types</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">system</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_bent_site_bonds"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_bent_site_bonds">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_bent_site_bonds</span><span class="p">(</span><span class="n">force_constant</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">util</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add bonds between sites on bent tubulins</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">([</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span> <span class="n">force_constant</span><span class="p">,</span> <span class="mf">3.73</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_detach&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_detach&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">4.0</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_detach&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_detach&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">4.0</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_bond</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_angles_between_tubulins"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_angles_between_tubulins">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_angles_between_tubulins</span><span class="p">(</span><span class="n">tubulin_type_sets</span><span class="p">,</span> <span class="n">force_constant</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">util</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add angles between tubulins</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.75</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.40</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.40</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.75</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">3.05</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">3.05</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.97</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_type_sets</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.67</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_tubulin_site_angles"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_tubulin_site_angles">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_tubulin_site_angles</span><span class="p">(</span><span class="n">tubulin_types</span><span class="p">,</span> <span class="n">force_constant</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">util</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add angles between a tubulin and its sites</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#4&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">0.79</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#4&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">0.79</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#4&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.05</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.05</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.05</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">0.79</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">0.79</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_bent_site_angles"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_bent_site_angles">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_bent_site_angles</span><span class="p">(</span><span class="n">tubulin_types</span><span class="p">,</span> <span class="n">force_constant</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">util</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add angles between sites on bent tubulins</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.51</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.51</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.63</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.63</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.66</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">3.05</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">3.05</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.35</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;site#1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span>
                <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.35</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span> <span class="n">force_constant</span><span class="p">,</span> <span class="mf">2.97</span><span class="p">,</span> <span class="n">system</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.97</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_angle</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.97</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_edge_site_angles"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_edge_site_angles">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_edge_site_angles</span><span class="p">(</span><span class="n">tubulin_types</span><span class="p">,</span> <span class="n">force_constant</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">util</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add angles between sites at the edge between tube and bent tubulins</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.81</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">0.3</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.84</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.4</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.75</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#out&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.81</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#1&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#1_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">2.84</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#2&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#2_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">0.3</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#3&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.75</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">add_polymer_angle_2D</span><span class="p">(</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">tubulin_types</span><span class="p">,</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;site#4&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GTP&quot;</span><span class="p">,</span> <span class="s2">&quot;site#4_GDP&quot;</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="n">force_constant</span><span class="p">,</span>
            <span class="mf">1.4</span><span class="p">,</span>
            <span class="n">system</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_polymer_repulsion"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_polymer_repulsion">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_polymer_repulsion</span><span class="p">(</span><span class="n">particle_types</span><span class="p">,</span> <span class="n">force_const</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">util</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        adds a pairwise repulsion between all polymer numbers</span>
<span class="sd">            of types particle_types</span>
<span class="sd">            with force constant force_const</span>
<span class="sd">            with equilibrium distance [nm]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">particle_types</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">+=</span> <span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">get_all_polymer_tubulin_types</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="n">util</span><span class="o">.</span><span class="n">add_repulsion</span><span class="p">(</span><span class="n">types</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">force_const</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_growth_reaction"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_growth_reaction">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_growth_reaction</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">rate_GTP</span><span class="p">,</span> <span class="n">rate_GDP</span><span class="p">,</span> <span class="n">reaction_distance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add dimers to the ends of protofilaments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_spatial_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Start_Grow_GTP: Microtubule(site#4_GTP) + Dimer(tubulinA#free) -&gt; &quot;</span>
            <span class="s2">&quot;Microtubule#Growing1-GTP(site#4--tubulinA#free)&quot;</span><span class="p">,</span>
            <span class="n">rate</span><span class="o">=</span><span class="n">rate_GTP</span><span class="p">,</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">reaction_distance</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_spatial_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Start_Grow_GDP: Microtubule(site#4_GDP) + Dimer(tubulinA#free) -&gt; &quot;</span>
            <span class="s2">&quot;Microtubule#Growing1-GDP(site#4--tubulinA#free)&quot;</span><span class="p">,</span>
            <span class="n">rate</span><span class="o">=</span><span class="n">rate_GDP</span><span class="p">,</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">reaction_distance</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Setup_Grow_GTP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Growing1-GTP&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_grow1_GTP</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Setup_Grow_GDP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Growing1-GDP&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_grow1_GDP</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Grow_GTP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Growing2-GTP&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_grow2_GTP</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Grow_GDP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Growing2-GDP&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_grow2_GDP</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_shrink_reaction"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_shrink_reaction">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_shrink_reaction</span><span class="p">(</span><span class="n">system</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        separate dimers and oligomers from the ends</span>
<span class="sd">        of frayed protofilaments and oligomers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Shrink_MT_GTP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_shrink_GTP</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">rate_function_shrink_GTP</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Shrink_MT_GDP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_shrink_GDP</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">rate_function_shrink_GDP</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Shrink_Oligo_GTP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Oligomer&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_shrink_GTP</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">rate_function_shrink_GTP</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Shrink_Oligo_GDP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Oligomer&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_shrink_GDP</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">rate_function_shrink_GDP</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Finish_Shrink&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Shrinking&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_shrink2</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Fail_Shrink_MT_GTP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Fail-Shrink-GTP&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">reaction_function_reset_state</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Fail_Shrink_MT_GDP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Fail-Shrink-GDP&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">reaction_function_reset_state</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Fail_Shrink_Oligo_GTP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Oligomer#Fail-Shrink-GTP&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">reaction_function_reset_state</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Fail_Shrink_Oligo_GDP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Oligomer#Fail-Shrink-GDP&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">reaction_function_reset_state</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_attach_reaction"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_attach_reaction">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_attach_reaction</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">rate_GTP</span><span class="p">,</span> <span class="n">rate_GDP</span><span class="p">,</span> <span class="n">reaction_distance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        attach protofilaments laterally</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_spatial_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Start_Attach_GTP1: Microtubule(site#1_GTP) + Microtubule(site#2_GTP) -&gt; &quot;</span>
            <span class="s2">&quot;Microtubule#Attaching(site#1--site#2) [self=true]&quot;</span><span class="p">,</span>
            <span class="n">rate</span><span class="o">=</span><span class="n">rate_GTP</span><span class="p">,</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">reaction_distance</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_spatial_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Start_Attach_GTP2: Microtubule(site#1_GTP) + Microtubule(site#2_GDP) -&gt; &quot;</span>
            <span class="s2">&quot;Microtubule#Attaching(site#1--site#2) [self=true]&quot;</span><span class="p">,</span>
            <span class="n">rate</span><span class="o">=</span><span class="n">rate_GTP</span><span class="p">,</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">reaction_distance</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_spatial_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Start_Attach_GTP3: Microtubule(site#1_GDP) + Microtubule(site#2_GTP) -&gt; &quot;</span>
            <span class="s2">&quot;Microtubule#Attaching(site#1--site#2) [self=true]&quot;</span><span class="p">,</span>
            <span class="n">rate</span><span class="o">=</span><span class="n">rate_GTP</span><span class="p">,</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">reaction_distance</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_spatial_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Start_Attach_GDP: Microtubule(site#1_GDP) + Microtubule(site#2_GDP) -&gt; &quot;</span>
            <span class="s2">&quot;Microtubule#Attaching(site#1--site#2) [self=true]&quot;</span><span class="p">,</span>
            <span class="n">rate</span><span class="o">=</span><span class="n">rate_GDP</span><span class="p">,</span>
            <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">reaction_distance</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Setup_Attach&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Attaching&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_attach</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_detach_reaction"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_detach_reaction">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_detach_reaction</span><span class="p">(</span><span class="n">system</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        detach protofilaments laterally</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Start_Detach&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_detach1</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">rate_function_detach_ring</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Detach_GTP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Detaching-GTP&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_detach2</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Detach_GDP&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Detaching-GDP&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_detach2</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MicrotubulesUtil.add_hydrolyze_reaction"><a class="viewcode-back" href="../../../simularium_models_util.microtubules.html#simularium_models_util.microtubules.microtubules_util.MicrotubulesUtil.add_hydrolyze_reaction">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_hydrolyze_reaction</span><span class="p">(</span><span class="n">system</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        hydrolyze GTP-tubulinB to GDP-tubulinB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Hydrolyze&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">reaction_function_hydrolyze</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">MicrotubulesUtil</span><span class="o">.</span><span class="n">rate_function_hydrolyze</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">system</span><span class="o">.</span><span class="n">topologies</span><span class="o">.</span><span class="n">add_structural_reaction</span><span class="p">(</span>
            <span class="s2">&quot;Fail_Hydrolyze&quot;</span><span class="p">,</span>
            <span class="n">topology_type</span><span class="o">=</span><span class="s2">&quot;Microtubule#Fail-Hydrolyze&quot;</span><span class="p">,</span>
            <span class="n">reaction_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">reaction_function_reset_state</span><span class="p">,</span>
            <span class="n">rate_function</span><span class="o">=</span><span class="n">ReaddyUtil</span><span class="o">.</span><span class="n">rate_function_infinity</span><span class="p">,</span>
        <span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Blair Lyons.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>